#!/bin/bash

# serial port set-up
stty 9600 raw -echo -echoe -echok -echoctl -echoke  < /dev/ttyAMA0

# RFID tag in range
hwctl export 4 in both
# left button
hwctl export 17 in both up
# centre button
hwctl export 27 in both up
# right button
hwctl export 22 in both up
# ready LED
hwctl export 10 out
# record LED
hwctl export 9 out
# upper button
hwctl export 11 in both up
# upper button
hwctl export 8 in both up

Platform="run.d/platform-box"
cd ${HOME}/projects/curio/git/box/

poll '+%s\n' ${Platform}/rfid \
    --unique \
    '+tir%s\n' ${Platform}/rfid-tir.input \
    --debounce 50 \
    '+right%s\n' ${Platform}/right-button.input \
    '+centre%s\n' ${Platform}/centre-button.input \
    '+left%s\n' ${Platform}/left-button.input \
    '+upper%s\n' ${Platform}/upper-button.input \
    '+lower%s\n' ${Platform}/lower-button.input \
    | \
node node_modules/box.js run.d/
